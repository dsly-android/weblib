#### 基础使用目录介绍
- 01.性能现状分析
- 02.前端优化说明
- 03.客户端优化分析
- 04.X5内核优化





### 01.性能现状分析
- 基于 WebView 的 H5 跨平台方案，优点确实非常明显。
    - 但是性能是它目前最大的问题，主要表现在以下两个方面：
        - 启动白屏时间。WebView 是一个非常重量级的控件，无论是 WebView 的初始化，还是整个渲染流程都非常耗时。这导致界面启动的时候会出现一段白屏时间，体验非常糟糕。
        - 响应流畅度。由于单线程、历史包袱等原因，页面的渲染和 JavaScript 的执行效率都不如原生。在一些重交互或者动画复杂的场景，H5 的性能还无法满足诉求。
- 回顾一下浏览器内核渲染的流程，我们其实可以把整个过程拆成三个部分：
    - Native 时间。主要是 Activity、WebView 创建以及 WebView 初始化的时间。虽然首次创建 WebView 的时间会长一些，但总体 Native 时间是可控的。
    - 网络时间。这里包括 DNS、TCP、SSL 的建连时间和下载主文档的时间。当解析主文档的时候，也需要同步去下载主文档依赖的 CSS 和 JS 资源，以及必要的数据。
    - 渲染时间。浏览器内核构建 Render Tree、Layout 并渲染到屏幕的时间。


### 02.前端优化说明
- 从前端的角度来看，常用的优化方法有：
    - 加快请求速度。
        - 整个启动过程中，网络时间是最不可控的。这里的优化方法有很多，例如预解析 DNS、减少域名数、减少 HTTP 请求数、CDN 分发、请求复用、懒加载、Gzip 压缩、图片格式压缩。
    - 代码优化。
        - 主文档的大小越小越好（要求小于 15KB），这里要求我们对 HTML、CSS 以及 JS 进行代码优化。以 JS 为例，前端的库和框架真的太多了，可能一不小心就引入了各种的依赖框架。对于核心页面，我们要求只能使用原生 JS 或者非常轻量级的 JS 框架，例如使用只有几 KB 的 Preact 代替庞大的 React 框架。
    - SSR。
        - 对于浏览器的渲染流程，上面描述的是 CSR 渲染模式，在这种模式下，服务器只返回页面的基本框架。
        - 事实上还有一种非常流行的SSR（Server Side Rendering）渲染模式，服务器可以一次性生成直接进行渲染的 HTML。以做到只有一个网络请求，但是带来的代价就是服务器计算资源的增加。一般来说，我们会在服务器前置 CDN 来解决访问量的问题。


### 03.客户端优化分析
- WebView 预创建。
    - 提前创建和初始化 WebView，以及实现 WebView 的复用，这块大约可以节省 100～200 毫秒。
- 缓存。
    - H5 是有多级的缓存机制，例如 Memory Cache 存放在内存中，一般资源响应回来就会放进去，页面关闭就会释放。
    - Client Cache 也就是客户端缓存，例如我们最常用的离线包方案，提前将需要网络请求的数据下发到客户端，通过拦截浏览器的资源请求实现加载。
    - Http Cache是我们比较熟悉的缓存机制，而 Net Cache 就是指 DNS 解析结果的缓存，或预连接的缓存等。
- 从性能上看，Memory Cache > Client Cache >= Http Cache > Net Cache。
    - 所谓的缓存，就是在用户真正点击打开页面之前，提前把数据、资源下载到本地内存或者磁盘中，并放到内核相应的缓存中。




### 04.X5内核优化
- 进一步往底层走，需要有定制修改甚至优化内核的能力。例如很多接口官方的浏览器内核可能并没有暴露，而腾讯X5的内核里面都会有很多的特殊接口。
    - 托管所有网络请求。
        - 我们不仅可以托管浏览器的 Get 请求，其他的所有 Post 请求也能接管，这样我们可以做非常多的定制化优化。
    - 私有接口。
        - 我们可以暴露很多浏览器的一些非公开接口。以预渲染为例，我可以指定在内存直接渲染某个页面，当用户真正打开的时候，只需要直接做刷新就可以了，实现真正的“秒开”。
    - 兼容性和安全。
        - Android 的碎片化导致浏览器内核的兼容性实在令人头疼，而且旧版本内核还存在不少的安全漏洞。
        - 在应用自带浏览器内核可以解决这些问题，而且高版本的内核特性也会更加完善，例如支持 TLS 1.3、QUIC 等。
        - 但是带来的代价是安装包增大 20MB 左右，当然也可以采用动态下载的方式。














